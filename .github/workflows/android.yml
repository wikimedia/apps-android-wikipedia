name: Build APK
on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - name: set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: temurin
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew
      - name: Build with Gradle
        run: |
          ./gradlew assembleRelease
           mv app/build/outputs/apk/release/*.apk $WORKDIR/release.apk
           zip -d release.apk "lib/armeabi-v7a/*" "lib/x86_64/*" "lib/x86/*" || exit 1
           zip -q -9 release.zip release.apk
        env:
          WORKDIR: '${{ github.workspace }}'
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
      - uses: actions/upload-artifact@v3
        with:
          name: Release
          path: release.apk
